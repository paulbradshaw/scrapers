#useful guides at:
#https://scraperwiki.com/docs/python/python_excel_guide/
#http://blog.scraperwiki.com/2011/09/14/scraping-guides-excel-spreadsheets/
#https://scraperwiki.com/docs/python/tutorials/

#import scraperwiki library 
import scraperwiki

#import xlrd library - documentation at https://secure.simplistix.co.uk/svn/xlrd/trunk/xlrd/doc/xlrd.html
import xlrd

URL = 'http://transparency.dh.gov.uk/2012/10/26/winter-pressures-daily-situation-reports-2012-13/'

#set a variable for the spreadsheet location
XLS = 'https://www.wp.dh.gov.uk/transparency/files/2012/10/DailySR-Pub-file-WE-11-11-123.xls'

#use the scrape function on that spreadsheet to create a new variable
xlbin = scraperwiki.scrape(XLS)
#use the open_workbook function on that new variable to create another
book = xlrd.open_workbook(file_contents=xlbin)

#use the sheet_by_index method to open the first (0) sheet in variable 'book' - and put it into new variable 'sheet'
sheet = book.sheet_by_index(0)

#print the results of using the row_values method and index (4) to grab the fifth row of 'sheet' 
print sheet.row_values(4)

#put the 5th row into 'keys' variable 
keys = sheet.row_values(2)

#assign a value to the 2nd item in 'keys' - with the results of using the replace method to replace the full stop in the 2nd item with nothing.
keys[1] = keys[1].replace('.', '')
print keys
#is keys a list? What is the result here?

#loop through a range - from the fifth item (4) to a number generated by using the .nrows method on 'sheet' (to find number of rows in that sheet?)
#put each row in 'rownumber' as you loop
for rownumber in range(4, sheet.nrows):
    # create dictionary of the row values
    values = [ cellval(c, book.datemode) for c in sheet.row(rownumber) ]
    data = dict(zip(keys, values))
    data['rownumber'] = rownumber

    # remove the empty column (which has a blank heading)
    del data['']

    # only save if it is a full row (rather than a blank line or a note)
    if data['DATE'] != None and data['FLEET NO'] != None:
        scraperwiki.sqlite.save(unique_keys=['rownumber'], data=data)